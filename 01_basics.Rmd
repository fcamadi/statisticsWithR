---
title: "01_basics"
author: "Fran Camacho"
date: "2025-03-25"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## 1. Intro

...


## 2. The basics


### 2.4.3 Vectors and data frames



```{r}
age <- c(10, 28, 48, 47, 71, 22, 80, 48, 30, 31)
age

age_months <- age * 12
age_months
```



```{r}
purchase <- c(14, 20, 59, 2, 12, 22, 160, 34, 34, 29)
purchase
```

It would be nice to combine these two vectors into a table -> dataframe

```{r}
bookstore <- data.frame(age, purchase)
bookstore
```

The fact that

```{r}
x <- 4
x
```


renders the output  [1] 4

tells us that **x in fact is a vector, albeit with a single element**. Almost everything in R is a vector, in one way or another.


**Exercise 2.4 Do the following:**

Create two vectors, height and weight, containing the heights and weights of five fictional people (i.e., just make up some numbers!).
Combine your two vectors into a data frame.

```{r}
names <- c("foo", "mola", "nandia", "fefe", "ogogo")
heights <- c(177, 220, 190, 168, 201)
weights <- c(88, 110, 95, 60, 90)

people1 <- data.frame(names, heights, weights)
people1
```


### 2.4.4 Functions


Compute the mean age of bookstore customers:

```{r}
mean(age)
mean(bookstore$age)
```

Note that the code follows the pattern function_name(variable_name): the function’s name is mean and the variable’s name is age.


Compute the **correlation** between the variables age and purchase:

```{r}
cor(bookstore$age, bookstore$purchase)
```

The answer, 0.59, means that there appears to be a fairly strong positive correlation between age and the purchase size, 
which implies that older customers tend to spend more.

On the other hand, just by looking at the data we can see that the oldest customer, aged 80, spent much more than anybody else – 160 monetary units. 
It can happen that such outliers strongly influence the computation of the correlation. 
By default, cor uses the **Pearson correlation formula**, which is known to be sensitive to outliers. 
It is therefore of interest to also perform the computation using a formula that is more robust to outliers, such as the **Spearman correlation**.

```{r}
cor(age, purchase, method = "spearman")
```

The resulting correlation, 0.35, is substantially lower than the previous result. Perhaps the correlation isn’t all that strong after all.

So, how can we know what arguments to pass to a function? We can look at the documentation  ->  ?cor


Finally, there are a few functions that don’t require any input at all, because they don’t do anything with your variables. 
One such example is **Sys.time()** which prints the current time on your system:

Sys.time()  

[1] "2025-03-25 21:48:15 CET"




**Exercise 2.6 Using the data you created in Exercise 2.4, do the following:**

Compute the mean height of the people.

Compute the correlation between height and weight.

```{r}
mean(people1$heights)

cor(people1$heights, people1$weights, method = "spearman")
```


**Exercise 2.7 Do the following:**

Read the documentation for the function length. What does it do? Apply it to your height vector.

Read the documentation for the function sort. What does it do? What does the argument decreasing (the values of which can be either FALSE or TRUE) do? Apply the function to your weight vector.

?length
"Get or set the length of vectors (including lists) and factors, and of any other R object for which a method has been defined."

?sort

```{r}
length(people1$heights)

sort(people1$weights, decreasing = TRUE)
```


### 2.4.5 Mathematical operations


abs(x): computes the absolute value |x|

sqrt(x): computes √x

log(x): computes the logarithm of x with the natural number e as the base

log(x, base = a): computes the logarithm of x with the number a as the base.

a^x: computes a to the power of x

exp(x): computes e to the power of x

sin(x): computes sin(x)

sum(x): when x is a vector x=(x1,x2,x3,…,xn), computes the sum of the elements of x: ∑ni=1xi

prod(x): when x is a vector x=(x1,x2,x3,…,xn), it computes the product of the elements of x

pi: a built-in variable with value π, the ratio of the circumference of a circle to its diameter.

x %% a: computes x modulo a

factorial(x): computes x!

choose(n,k): computes 
(n)
(k)


```{r}
exp(1)

sin(people1$weights)

sum(people1$weights)

factorial(4)

choose(4,2)
```


**Exercise 2.8 Compute the following:**

√π

e2⋅log(4)


```{r}
sqrt(pi)

exp(2)*log(4)
```


**Exercise 2.9**
R will return non-numerical answers if you try to perform computations where the answer is infinite or undefined. Try the following to see some possible results:**

- Compute 1/0

1/0
[1] Inf

- Compute 0/0

0/0
[1] NaN


Compute √−1

sqrt(-1)
[1] NaN
Aviso:
In sqrt(-1) : Se han producido NaNs



### 2.5 Packages

In the rest of this chapter, we’ll make use of a package called ggplot2, which adds additional graphical features to R. 

```{r}
install.packages("ggplot2")

library(ggplot2)
```

Exercise 2.10 Install the palmerpenguins package from CRAN. We’ll use it for many of the exercises and examples that follow.

```{r}
install.packages("palmerpenguins")

library(palmerpenguins)
```


### 2.6 Descriptive statistics


To begin with, let’s explore the **msleep** dataset.

```{r}
msleep
```


To view all 83 rows and all 11 variables, use:

```{r}
View(msleep)
```

To find information about the data frame containing the data, some useful functions are:

head(msleep)
tail(msleep)
dim(msleep)
str(msleep)
names(msleep)


```{r}
str(msleep)
```

**Numerical data**

```{r}
summary(msleep)
```

Finally, you’ll notice that msleep isn’t listed among the variables in the Environment pane in RStudio. To include it there, you can run:

```{r}
msleep <- data.frame(msleep)
```


```{r}

mean(msleep$sleep_total)      # Mean
median(msleep$sleep_total)    # Median
max(msleep$sleep_total)       # Max
min(msleep$sleep_total)       # Min
sd(msleep$sleep_total)        # Standard deviation
var(msleep$sleep_total)       # Variance
quantile(msleep$sleep_total)  # Various quantiles

```

To see how many animals sleep for more than 8 hours a day, we can use the following:

```{r}
sum(msleep$sleep_total > 8)   # Frequency (count)
mean(msleep$sleep_total > 8)  # Relative frequency (proportion)
```

Note that the NA values have not been removed from msleep. Setting na.rm = TRUE simply tells R to ignore them in a particular computation, not to delete them:

```{r}
mean(msleep$sleep_rem, na.rm = TRUE)
```

We run into the same problem if we try to compute the correlation between sleep_total and sleep_rem:

```{r}
cor(msleep$sleep_total, msleep$sleep_rem)
```


```{r}
cor(msleep$sleep_total, msleep$sleep_rem, use = "complete.obs")  # <- use complete obsevations only
```


**Categorical data**

```{r}
table(msleep$vore)
```


```{r}
round(proportions(table(msleep$vore)),3)
```

The table function can also be used to construct a cross-table that shows the counts for different combinations of two categorical variables:

```{r}
# Counts:
table(msleep$vore, msleep$conservation)

# Proportions, per row:
proportions(table(msleep$vore, msleep$conservation), margin = 1)

# Proportions, per column:
proportions(table(msleep$vore, msleep$conservation), margin = 2)

# Proportions, out of total:
proportions(table(msleep$vore, msleep$conservation))
```

### 2.7 Plotting numerical data

We will mainly focus on creating plots using the **ggplot2** package, which allows us to create good-looking plots using 
the so-called **grammar of graphics**. The grammar of graphics is a set of structural rules that helps us establish a language 
for graphics. The beauty of this is that (almost) all plots will be created with functions that all follow the same logic, or grammar.

The three key components to grammar of graphics plots are:

- Data: observations in your dataset,
    
- Aesthetics: mappings from the data to visual properties (like axes and sizes of geometric objects), and
    
- Geoms: geometric objects representing what you see in the plot, e.g., lines or points.



1) let’s make a scatterplot by plotting the total sleep time of an animal against the REM sleep time of an animal.

plot

```{r, warning=FALSE}

plot(msleep$sleep_total, msleep$sleep_rem)

plot(msleep$sleep_total, msleep$sleep_rem, pch = 16)
grid()

```
ggplot

```{r}
ggplot(msleep, aes(x = sleep_total, y = sleep_rem)) + 
  geom_point()
```


The ggplot2 code looks ... different. 
This is because it uses the grammar of graphics, which in many ways is a language of its own, different from how we otherwise work with R.

The syntax used to create the ggplot2 scatterplot was in essence **ggplot(data, aes) + geom**. 


**Exercise 2.12**
Create a scatterplot with total sleep time along the x-axis and time awake along the y-axis (using the msleep data). 
What pattern do you see? Can you explain it?

```{r, warning=FALSE}
ggplot(msleep, aes(sleep_total, awake)) +
      geom_point()
```

**Colours, shapes and axis labels**


```{r}
ggplot(msleep, aes(sleep_total, sleep_rem)) +
      #geom_point() +
      geom_point(colour = "blue") +
      labs(x = "Total sleep time (h)")
```

Use the colours of the point to separate different categories. This is done by adding a **colour argument** to aes


```{r}
ggplot(msleep, aes(sleep_total, sleep_rem, colour = vore)) +
      geom_point() +
      labs(x = "Total sleep time (h)", y = "Total sleep time REM (h)")
```

What happens if we use a continuous variable, such as the sleep cycle length sleep_cycle to set the colour?

A gradient is used:

```{r}
ggplot(msleep, aes(sleep_total, sleep_rem, colour = sleep_cycle)) +
      geom_point() +
      labs(x = "Total sleep time (h)", y = "Total sleep time REM (h)")
```




**Exercise 2.13** 

Using the penguins data, do the following:

1. Create a scatterplot with bill length along the x-axis and flipper length along the y-axis. Change the x-axis label to read “Bill length (mm)” and the y-axis label to “Flipper length (mm)”. Use species to set the colour of the points.

```{r}
ggplot(penguins, aes(x = bill_length_mm, y = flipper_length_mm, colour = species)) +
      geom_point() +
      labs(x = "Bill length (mm)", y = "Flipper length (mm)")
```

2. Try adding the argument alpha = 1 to geom_point, i.e., geom_point(alpha = 1). Does anything happen? Try changing the 1 to 0.75 and 0.25 and see how that affects the plot.

```{r}
ggplot(penguins, aes(x = bill_length_mm, y = flipper_length_mm, colour = species)) +
      geom_point(alpha=0.5) +
      labs(x = "Bill length (mm)", y = "Flipper length (mm)")
```

We can change the opacity of the points by adding an **alpha argument** to geom_point. This is useful when the plot contains overlapping points:




**Exercise 2.14**

Similar to how you changed the colour of the points, you can also change their size and shape. 
The arguments for this are called size and shape.

1. Change the scatterplot from Exercise 2.13 so that animals from different islands are represented by different shapes.

```{r}
ggplot(penguins, aes(x = bill_length_mm, y = flipper_length_mm, colour = species, shape = island)) +
      geom_point(alpha=0.9) +
      labs(x = "Bill length (mm)", y = "Flipper length (mm)")
```

2. Then change it so that the size of each point is determined by the body mass, i.e., the variable body_mass_g.

```{r, fig.width=10}

ggplot(penguins, aes(x = bill_length_mm, y = flipper_length_mm, colour = species, shape = island, size = body_mass_g)) +
      geom_point(alpha=0.9) +
      labs(x = "Bill length (mm)", y = "Flipper length (mm)")
```


**Axis limits and scales**

Next, assume that we wish to study the relationship between animals’ brain sizes and their total sleep time:

```{r}
ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight", y = "Total sleep time")
```
There are two animals with brains that are much heavier than the rest (African elephant and Asian elephant). 
These outliers distort the plot, making it difficult to spot any patterns. 
We can try changing the x-axis to only go from 0 to 1.5 by adding xlim to the plot, to see if that improves it:

```{r}
ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight", y = "Total sleep time") +
      xlim(0, 1)
```
This is slightly better, but we still have a lot of points clustered near the y-axis, and some animals are now missing from the plot. 
If instead we wished to change the limits of the y-axis, we would have used ylim in the same fashion.

Another option is to rescale the x-axis by applying a **log transform** to the brain weights, which we can do directly in aes:


```{r}
ggplot(msleep, aes(log(brainwt), sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "log(Brain weight)", y = "Total sleep time")
```

This is a better-looking scatterplot, with a weak declining trend. We didn’t have to remove the outliers (elephants) to create it, which is good.
The downside is that the x-axis now has become difficult to interpret.
A third option that mitigates this is to add scale_x_log10 to the plot, which changes the scale of the x-axis to a **log10 scale** 
(which increases interpretability because the values shown at the ticks still are on the original x-scale).


```{r}
ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight (logarithmic scale)", y = "Total sleep time") +
      scale_x_log10()
```

The numbers on the x-axis are displayed with scientific notation. 
You can change the settings in R to use decimals, instead, using the options function as follows:

```{r}

options(scipen = 1000)

ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight (logarithmic scale)", y = "Total sleep time") +
      scale_x_log10()
```

**Exercise 2.15**

Using the msleep data, create a plot of log-transformed body weight versus log-transformed brain weight. 
Use total sleep time to set the colours of the points. Change the text on the axes to something informative.

```{r}

options(scipen = 1000)

ggplot(msleep, aes(bodywt, brainwt, colour = sleep_total)) + 
      geom_point() +
      labs(x = "Brain weight (logarithmic scale)", y = "Body weight (logarithmic scale)") +
      scale_x_log10() +
      scale_y_log10()
```

**Comparing groups**


```{r} 
ggplot(msleep, aes(brainwt, sleep_total)) +   # no colour = vore here
      geom_point() +
      labs(x = "Brain weight (logarithmic scale)", y = "Total sleep time") +
      scale_x_log10() +
      facet_wrap(~ vore)                      # but fact_wrap
```

Note that the x-axes and y-axes of the different plots in the grid all have the same scale and limits.



**Exercise 2.16** 

Using the penguins data, do the following:

1. Create a scatterplot with bill_length_mm along the x-axis and flipper_length_mm along the y-axis, facetted by species.

```{r} 
ggplot(penguins, aes(bill_length_mm, flipper_length_mm)) +   # no colour = vore here
      geom_point() +
      labs(x = "Bill length", y = "Flipper length time") +
      ##scale_x_log10() +
      facet_wrap(~ species)                                  # but fact_wrap
```


2. Read the documentation for facet_wrap (?facet_wrap). How can you change the number of rows in the plot grid? Create the same plot as in part 1, but with 2 rows.

```{r} 
ggplot(penguins, aes(bill_length_mm, flipper_length_mm)) +   # no colour = vore here
      geom_point() +
      labs(x = "Bill length", y = "Flipper length") +
      ##scale_x_log10() +
      facet_wrap(~ species, nrow=2)                          # but fact_wrap
```


















