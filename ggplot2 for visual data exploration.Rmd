---
title: "ggplot2 for visual data exploration"
author: "Fran Camacho"
date: "2025-04-15"
output: word_document
---


## Using ggplot2 for visual data exploration

[From the book  "Machine Learning with R", by Brett Lantz].



Load libraries

```{r}
# Load the ggplot2 package
if (!require(ggplot2)) install.packages('ggplot2', dependencies = T)
library(ggplot2)
```



Load the Titanic model training dataset and examining its features

```{r}
titanic_train <- read.csv("./Chapter11/titanic_train.csv")
str(titanic_train)
```

Every ggplot2 visualization is composed of layers, which place graphics upon a blank canvas.
Executing the ggplot() function alone creates an empty gray plot area with no data points:

```{r}
library(ggplot2)

p <- ggplot(data = titanic_train)
p
```

To create something more interesting than a blank gray coordinate system, we’ll need to add
additional layers to the plot object stored in the p object.

Let’s begin by creating a simple boxplot of the Age feature.

To accomplish the same in the ggplot2 environment, we simply add geom_boxplot() to the blank
coordinate system, with the aes() aesthetic mapping function indicating that we would like the
Age feature to be mapped to the y coordinate as follows.

```{r warning=FALSE}
# R’s built-in boxplot function
boxplot(titanic_train$Age)

boxplot_1 <- p + geom_boxplot(mapping = aes(y = Age))
boxplot_1
```


The resulting figures are largely similar, with only a few stylistic differences in how the data is presented.

Although it may seem pointless to use the more complicated ggplot() visualization when the
simpler function will suffice, the strength of the framework is its ability to visualize bivariate re-
lationships with only small changes to the code. For example, suppose we’d like to examine how
age is related to survival status:

```{r warning=FALSE}
# warning=FALSE

p + geom_boxplot(aes(x = Age, y = as.factor(Survived)))
```

To examine the distribution of numeric features:

```{r warning=FALSE}
# plot version
hist(titanic_train$Age)

# ggplot version uses the geom_histogram()
p + geom_histogram(aes(x = Age))
```

Again, where the ggplot2 framework shines is the ability to make a few small tweaks and reveal
interesting relationships in the data. Here, let’s examine three variants of the same comparison
of age and survival.

**fill** colorizes the bars according to the levels of the factor provided

```{r warning=FALSE}
p + geom_histogram(aes(x = Age, fill = as.factor(Survived)), bins = 80) +
  ggtitle("Distribution of Age by Titanic Survival Status")
```

Second, rather than having overlapping histograms, we can create a grid of side-by-side plots
using the **facet_grid()** function:

```{r warning=FALSE}
p + geom_histogram(aes(x = Age, fill = as.factor(Survived))) +
  facet_grid(cols = vars(Survived)) +
  ggtitle("Distribution of Age by Titanic Survival Status")
```

Third, rather than using the histogram geom, we can use geom_density() to create a density plot:

```{r warning=FALSE}
p + geom_density(aes(x = Age,
  color = as.factor(Survived),
  fill = as.factor(Survived)),
  alpha = 0.25) +
  ggtitle("Density of Age by Titanic Survival Status")
```

Let’s examine a few more plots to see if we can uncover more details of the Titanic’s evacuation
policies. We’ll begin by confirming the assumed differences in survival by gender.

```{r}
p + geom_bar(aes(x = Sex)) +
ggtitle("Titanic Passenger Counts by Gender")
```

A more interesting visualization would be to compare the rate of survival by gender.

To do this, we must not only supply the Survived outcome as the y parameter to the aes() function but also
tell the geom_bar() function to compute a summary statistic of the data—in particular, using
the mean function —using the stat and fun parameters as shown:

```{r}
p + geom_bar(aes(x = Sex, y = Survived),  stat = "summary", fun = "mean") +
  ggtitle("Titanic Survival Rate by Gender")
```

Let's examine the passenger class (Pclass) feature in a few different ways.

```{r}
p + geom_bar(aes(x = Pclass, y = Survived),  stat = "summary", fun = "mean") +
  ggtitle("Titanic Survival Rate by Passenger Class")
```

Color can be an effective tool to communicate additional dimensions. Using the fill parameter,
we’ll create a simple bar chart of passenger counts with bars that are filled with color according
to survival status, which is converted to a factor:

```{r}
p + geom_bar(aes(x = Pclass, fill = factor(Survived, labels = c("No", "Yes")))) +
  labs(fill = "Survived") +
  ylab("Number of Passengers") +
  ggtitle("Titanic Survival Counts by Passenger Class")
```

The result highlights the fact that the overwhelming number of deceased came from the third-class section of the ship.

Next, we’ll modify this plot using a position parameter that informs ggplot() how to arrange
the colorized bars. In this case, we’ll set position = "fill", which creates a stacked bar chart
that fills the vertical space—essentially giving each color in the stack a relative proportion out
of 100 percent:

```{r}
p + geom_bar(aes(x = Pclass, fill = factor(Survived, labels = c("No", "Yes"))), position = "fill") +
  labs(fill = "Survived") +
  ylab("Proportion of Passengers") +
  ggtitle("Titanic Survival by Passenger Class")
```

The resulting figure emphasizes the decreased odds of survival for the lower classes.


Lastly, we’ll attempt to visualize the relationship between three dimensions: passenger class, gender, and survival. 

The Pclass and Survived features define the x and y dimensions, leaving Sex to define the bar colors via the fill parameter. 

Setting the position = "dodge" tells ggplot() to place the colored bars side-by-side rather than stacked, 
while the stat and fun parameters compute the survival rate. 

The full command is as follows:

```{r}
p + geom_bar(aes(x = Pclass, y = Survived, fill = Sex), 
  position = "dodge", stat = "summary", fun = "mean") +
  ylab("Survival Proportion") +
  ggtitle("Titanic Survival by Passenger Class")
```
