---
title: "02_cornerstones_of_stadistics"
author: "Fran Camacho"
date: "2025-08-06"
output:
  html_document:
    df_print: paged
---

# 02 - Cornerstones of Stadistics


```{r}
#Libraries

#https://tidyverse.r-universe.dev/tidyverse
if (!require(tidyverse)) install.packages('tidyverse', repos = c('https://tidyverse.r-universe.dev', 'https://cloud.r-project.org'))
library(tidyverse)

# Install the packages:
#install.packages(c("gtsummary", "flextable", "ivo.table"))

if (!require(gtsummary)) install.packages('gtsummary', dependencies = T)
library(gtsummary)
if (!require(flextable)) install.packages('flextable', dependencies = T)
library(flextable)
if (!require(ivo.table)) install.packages('ivo.table', dependencies = T)
library(ivo.table)


```

## 3.1 The three cultures

There are three main schools in statistical modelling: 
the frequentist school, 
the Bayesian school, and 
the machine learning school.


## 3.2 Frequencies, proportions, and cross-tables


```{r}
library(palmerpenguins)
?penguins
```


- Frequency tables:
Frequency tables are used to summarise the distribution of a single variable. 

Without pipes:
```{r}
table(penguins$species)
```

With pipes:
```{r}
library(dplyr)
penguins |> select(species) |> table()
```


- Publication-ready tables

The table in the previous section is fine for data exploration but requires some formatting if you wish to put it in a report. 
If instead you want something publication-ready that you can put straight into a report or a presentation, 
I recommend using either the **gtsummary** package or the **ivo.table** package. 

```{r}
# Install the packages:
#install.packages(c("gtsummary", "flextable", "ivo.table"))

if (!require(gtsummary)) install.packages('gtsummary', dependencies = T)

if (!require(flextable)) install.packages('flextable', dependencies = T)
library(flextable)
if (!require(ivo.table)) install.packages('ivo.table', dependencies = T)
library(ivo.table)
```


Without pipes:
```{r}
library(gtsummary)

tbl_summary(penguins[,"species"])
```

With pipes:
```{r}
library(dplyr)
library(gtsummary)

penguins |>
  select(species) |>
  tbl_summary()
```


The **ivo.table** package and the **ivo_table** function offer a similar table constructed in the same way:

Without pipes:
```{r}
library(ivo.table)

ivo_table(penguins[,"species"])
```


With pipes:
```{r}
library(dplyr)
library(ivo.table)

penguins |>
  select(species) |>
  ivo_table()
```

You can modify the settings to change the colours and fonts used, and to show percentages instead of counts:
```{r}
penguins |>
  select(species) |>
  ivo_table(color = "darkred",
            font = "Garamond",
            percent_by = "row")
```

If you prefer, you can also get the table in a long format that is useful when your variable has many different levels:
```{r}
penguins |>
  select(species) |>
  ivo_table(long_table = TRUE)
```

Finally, the table can be exported to Word as follows:
```{r}
library(flextable)

penguins |>
  select(species) |>
  ivo_table() |> 
  save_as_docx(path = "my_table.docx")
```



- **Contingency tables**

Contingency tables, also known as **cross-tabulations** or **cross-tables**, are used to summarise the relationship between two or more variables.
They consist of a table with rows and columns that represent the different values of the variables, and the entries in the table show the number or proportion of times each combination of values occurs in the data. For example, a contingency table for the variables species and island in the penguins data shows the number of individuals of different species at different islands.


Without pipes:
```{r}
ftable(penguins$island, penguins$species)
```

With pipes:
```{r}
penguins |> select(island, species) |> ftable()
```

Again, we can create a nicely formatted publication-ready table. With ivo_table, we follow the same logic as before:
```{r}
library(ivo.table)

penguins |> select(species, island) |>
            ivo_table()
```

To create a contingency table using tbl_summary, we use the following syntax:

Without pipes:
```{r}
library(gtsummary)

tbl_summary(penguins[,c("species","island")], by = species)
#tbl_summary(penguins[,c("species","island")], by = island)
```


With pipes:
```{r}
library(dplyr)
library(gtsummary)

penguins |> select(species, island) |> tbl_summary(by=species)
```


Contingency tables are great for presenting data, and in many cases we can draw conclusions directly from looking at such a table. 
For instance, in the example above, it is clear that Adelie penguins are the only species present at all three islands 
(or at least, the only species sampled at all three islands). In other cases, the results aren’t as clear-cut. 
That’s when statistical hypothesis testing becomes useful ...


- Three-way and four-way tables

Three-way and four-way tables are contingency tables showing the distribution of three and four variables, respectively. 
They are straightforward to create using ftable or ivo_table.

We simply select the variables we wish to include in the table, and use ftable or ivo_table as in previous examples.
Here are some examples using ivo_table:


```{r}
# A three-way table:
library(ivo.table)

penguins |> select(sex, species, island) |>
            ivo_table()
```


```{r}
# Exclude missing values:
penguins |> select(sex, species, island) |>
            ivo_table(exclude_missing = TRUE)
```

```{r}
# A four-way table:
penguins |> select(sex, species, island, year) |>
            ivo_table()
```


You can’t use gtsummary to construct three-way and four-way tables, but you can use it for a similar type of table, presenting several variables at once, stratified by another variable. For instance, we can show the frequencies of islands and sexes stratified by species, as in the example below. This type of table, showing the distributions of different categorical variables, is often referred to as **Table 1** in scientific papers.

Without pipes:
```{r}
library(gtsummary)

tbl_summary(penguins[,c("species","sex","island")], by = species)
```


With pipes:
```{r}
library(dplyr)
library(gtsummary)

penguins |>
  select(species, sex, island) |>
  tbl_summary(by = species)
```












