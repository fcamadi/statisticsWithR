---
title: "04_EDA_and_unsupervised_learning"
author: "Fran Camacho"
date: "2025-08-19"
output:
  word_document: default
  pdf_document: default
  html_document:
    df_print: paged
---


# 4 - Exploratory data analysis and unsupervised learning

https://modernstatisticswithr.com/eda.html#eda

`x = 2 * z`


```{r}
#Libraries

#https://tidyverse.r-universe.dev/tidyverse
if (!require(tidyverse)) install.packages('tidyverse', repos = c('https://tidyverse.r-universe.dev', 'https://cloud.r-project.org'))
library(tidyverse)

#Additional themes for ggplot2
if (!require(hrbrthemes)) install.packages('hrbrthemes', dependencies = T)
install.packages("hrbrthemes")
if (!require(ggthemes)) install.packages('ggthemes', dependencies = T)
install.packages("ggthemes")
```


Exploratory data analysis (EDA) is a process in which we summarise and visually explore a dataset.
An important part of EDA is unsupervised learning, which is a collection of methods for finding interesting subgroups and patterns in our data. 
Unlike statistical hypothesis testing, which is used to reject hypotheses, EDA can be used to generate hypotheses
(which can then be confirmed or rejected by new studies). Another purpose of EDA is to find outliers and incorrect observations,
which can lead to a cleaner and more useful dataset.

...


## 4.1 Reports with R Markdown

...

### Formatting text

To create plain text in a Markdown file, you simply have to write plain text. 
If you wish to add some formatting to your text, you can use the following:

- _italics_ or *italics*: to create text in italics.

- __bold__ or **bold**: to create bold text.

- [linked text](http://www.modernstatisticswithr.com): to create linked text.

- `code`: to include inline code in your document.

- to create inline equations like a2+b2=c2 using LaTeX syntax:  $a^2 + b^2 = c^2$

- to create a centred equation on a new line: $$a^2 + b^2 = c^2$$: 

...


### Lists, tables, and images


To create a **bullet list**, you can use * as follows. Note that you need a blank line between your list and the previous paragraph to begin a list.

* Item 1
* Item 2
   + Sub-item 1
   + Sub-item 2
* Item 3


To create an **ordered list**, use:

1. First item
2. Second item
  i) Sub-item 1
  ii) Sub-item 2
3. Item 3

To create a **table**, use | and --------- as follows:

Column 1  | Column 2
--------- | ---------
Content  | More content
Even more  | And some here
Even more?  | Yes!


To include an **image**, use the same syntax as when creating linked text with a link to the image path 
(either local or on the web), but with a ! in front:

![](https://www.r-project.org/Rlogo.png)

![The R logo.](https://www.r-project.org/Rlogo.png)


### Code chunks

In RStudio, **Ctrl+Alt+I** is a keyboard shortcut for inserting this kind of code chunk:

```{r}

```

We can add a name and a caption to the chunk, which lets us reference objects created by the chunk:

```{r pressureplot, fig.cap = "Plot of the pressure data."}
plot(pressure)
```

As we can see in Figure \@ref(fig:pressureplot), the relationship between temperature and pressure resembles a banana.

In addition, you can add settings to the chunk header to control its behaviour:

- echo = FALSE      to run the code without printing it,
- eval = FALSE      to print the code without running it,
- results = "hide"  to hide printed output,
- fig.show = "hide" to hide plots,
- warning = FALSE   to suppress warning messages from being printed in your document,
- message = FALSE   to suppress other messages from being printed in your document,
- include = FALSE   to run a chunk without showing the code or results in the document,
- error = TRUE      to continue running your R Markdown document even if there is an error in the chunk 
                    (by default, the documentation creation stops if there is an error).


Data frames can be printed either as in the Console or as a nicely formatted table. 

For example:

```{r}
head(airquality)
```
whereas yields a nicely formatted table:

```{r}
knitr::kable(
  head(airquality),
  caption = "Some data I found."
)
```



## 4.2 Customising ggplot2 plots

We’ll be using ggplot2 a lot in this chapter; so, before we get started with exploratory analyses,
we’ll take some time to learn how we can customise the look of ggplot2-plots.

Consider the following facetted plot from Section 2.7.4:

```{r}
library(ggplot2)

ggplot(msleep, aes(brainwt, sleep_total)) + 
      geom_point() +
      labs(x = "Brain weight (logarithmic scale)",
           y = "Total sleep time") +
      scale_x_log10() +
      facet_wrap(~ vore)
```

It looks nice, sure, but there may be things that you’d like to change. Maybe you’d like the plot’s background to be white instead of grey, 
or perhaps you’d like to use a different font. These, and many other things, can be modified using *themes* and *palettes*. 
Before we look at that, we’ll take a quick look at how to modify the labels and axes of the plot.


### Modifying labels

```{r}
ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight (logarithmic scale)",
           y = "Total sleep time",
           colour = "Feeding behaviour") +
      scale_x_log10()
```


### Modifying axis scales

We’ve seen how functions with names beginning with scale_x, such as scale_x_log10 can be used to modify the scale of the x-axis 
(and scale_y-functions used to modify the y-axis). In addition to log transforms, we can for instance control where the tick marks 
are located by using the breaks argument. If we only want to modify the tick marks (without doing a log transform), 
we can use **scale_x_continuous**:

```{r}
# Default:
ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight",
           y = "Total sleep time",
           colour = "Feeding behaviour")
```


```{r}
# Tick marks at all integers from 0 to 6:
ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight",
           y = "Total sleep time",
           colour = "Feeding behaviour") +
      scale_x_continuous(breaks = 0:6)
```


```{r}
# Tick mark at specific values:
ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight",
           y = "Total sleep time",
           colour = "Feeding behaviour") +
      scale_x_continuous(breaks = c(0, 2.5, 4.25))
```


### Using themes

ggplot2 comes with a number of basic themes. All are fairly similar but differ in things like background colour, grids, and borders.
You can add them to your plot using theme_themeName, where themeName is the name of the theme24. Here are some examples:

```{r}
p <- ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight (logarithmic scale)",
           y = "Total sleep time",
           colour = "Feeding behaviour") +
      scale_x_log10() +
      facet_wrap(~ vore)

# Create plot with different themes:
p + theme_grey() # The default theme
p + theme_bw()
p + theme_linedraw()
p + theme_light()
p + theme_dark()
p + theme_minimal()
p + theme_classic()
```


There are several packages available that contain additional themes. Let’s try a few:

```{r}
#install.packages("ggthemes")
library(ggthemes)

# Create plot with different themes from ggthemes:
p + theme_tufte() # Minimalist Tufte theme
p + theme_wsj() # Wall Street Journal
p + theme_solarized() + scale_colour_solarized() # Solarized colours
```


```{r}
#install.packages("hrbrthemes")
library(hrbrthemes)

# Create plot with different themes from hrbrthemes:
p + theme_ipsum() # Ipsum theme
p + theme_ft_rc() # Suitable for use with dark RStudio themes
p + theme_modern_rc() # Suitable for use with dark RStudio themes
```


###  Colour palettes

Unlike, e.g., background colours, the colour palette, i.e., the list of colours used for plotting, is not part of the theme that you’re using.
Next, we’ll have a look at how to change the colour palette used for your plot.

Let’s start by creating a ggplot object:

```{r}
p <- ggplot(msleep, aes(brainwt, sleep_total, colour = vore)) + 
      geom_point() +
      labs(x = "Brain weight (logarithmic scale)",
           y = "Total sleep time",
           colour = "Feeding behaviour") +
      scale_x_log10()
```

You can change the colour palette using scale_colour_brewer. Three types of colour palettes are available:

- **Sequential palettes**: these range from a colour to white. These are useful for representing ordinal 
(i.e., ordered) categorical variables and numerical variables.

- **Diverging palettes**: these range from one colour to another, with white in between. 
Diverging palettes are useful when there is a meaningful middle or 0 value 
(e.g., when your variables represent temperatures or profit/loss), which can be mapped to white.

- **Qualitative palettes**: these contain multiple distinct colours. They are useful for nominal (i.e., with no natural ordering) categorical variables.

See ?scale_colour_brewer or visit http://www.colorbrewer2.org for a list of the available palettes.
Here are some examples:

```{r}
# Sequential palette:
p + scale_colour_brewer(palette = "OrRd")
```


```{r}
# Diverging palette:
p + scale_colour_brewer(palette = "RdBu")
```


```{r}
# Qualitative palette:
p + scale_colour_brewer(palette = "Set1")
```

In this case, because vore is a nominal categorical variable, a qualitative palette is arguably the best choice.

In addition to these ready-made palettes, you can create your own custom palettes. 
...


###  Theme settings

The point of using a theme is that you get a combination of colours, fonts, and other choices that are supposed to go well together, 
meaning that you don’t have to spend too much time picking combinations. But if you like, you can override the default options 
and customise any and all parts of a theme.

The theme controls all visual aspects of the plot not related to the aesthetics. You can change the theme settings using the theme function. 
For instance, you can use theme to remove the legend or change its position:


```{r}
# No legend:
p + theme(legend.position = "none")

# Legend below figure:
p + theme(legend.position = "bottom")

# Legend inside plot:
p + theme(legend.position.inside = c(0.9, 0.7))
```

The base size of a theme controls the scale of the entire figure. This makes it useful when you want to rescale all elements of your plot at the same time:

```{r}
p + theme_grey(base_size = 8)
p + theme_grey(base_size = 20)
```
theme has a lot of other settings, including for the colours of the background, the grid, and the text in the plot. 
Here are a few examples that you can use as a starting point for experimenting with the settings:

```{r}
p + theme(panel.grid.major = element_line(colour = "black"),
          panel.grid.minor = element_line(colour = "purple",
                                          linetype = "dotted"),
          panel.background = element_rect(colour = "red", size = 2),
          plot.background = element_rect(fill = "lightgreen"),
          axis.text = element_text(family = "mono", colour = "blue"),
          axis.title = element_text(family = "serif", size = 14))
```






